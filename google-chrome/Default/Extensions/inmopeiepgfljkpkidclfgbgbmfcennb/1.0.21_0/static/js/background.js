!function(){"use strict";function e(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function r(r,t){if(r){if("string"===typeof r)return e(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(r,t):void 0}}function t(t){return function(r){if(Array.isArray(r))return e(r)}(t)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=function(e){return"@RESPONSIVE-VIEWER/".concat(e||"")};var a=function(e){return(e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]},i=function(e){var r,i=!1,o=new Map;if(e.id&&e.url){chrome.tabs.executeScript(e.id,{code:"window.location.reload()"},(function(e){}));var s=a(e.url),u=function(r){var n=t(r.responseHeaders||[]);return e.id!==r.tabId?{responseHeaders:n}:(0===r.frameId&&n.push({name:"Content-Type",value:"image/png"}),{responseHeaders:null===n||void 0===n?void 0:n.filter((function(e){var r=e.name.toLowerCase();return-1===["x-frame-options","content-security-policy","frame-options"].indexOf(r)}))})},d=function(r){e.id===r.tabId&&"about:blank"!==r.url&&(0!==r.frameId?a(r.url)===s&&o.get(r.frameId)&&chrome.tabs.executeScript(r.tabId,{file:"static/js/inject.js",frameId:r.frameId,runAt:"document_start"}):!1===i&&(i=!0,function(e){e.id&&(chrome.tabs.executeScript(e.id,{file:"static/js/init.js",runAt:"document_start"}),chrome.tabs.executeScript(e.id,{file:"static/js/main.js",runAt:"document_start"}))}(e)))},c=function(r){if(r.tabId===e.id&&0!==r.frameId){if(r.url.startsWith("about:blank?screenId=")){var t=new URL(r.url).searchParams.get("screenId");return o.set(r.frameId,t),void chrome.tabs.sendMessage(r.tabId,{message:n("FRAME_CONNECTED"),frameId:r.frameId,screenId:t},(function(){}))}var a=o.get(r.frameId);a&&chrome.tabs.sendMessage(r.tabId,{message:n("FRAME_REFRESHED"),screenId:a},(function(){}))}},m=function(t,a,i){if(a.tab&&e.id&&a.tab.id===e.id){switch(t.message){case n("GET_TAB_URL"):i({tabUrl:e.url});break;case n("CAPTURE_SCREEN"):chrome.tabs.captureVisibleTab(e.windowId,{format:"png"},(function(e){i({image:e})}));break;case n("WAIT"):setTimeout((function(){i({})}),t.time);break;case n("LOAD_STATE"):r=t.state,i({});break;case n("GET_SCREEN_ID"):i({screenId:o.get(a.frameId),ok:!0});break;default:i({})}return!0}},f=function(n){if(n.tabId===e.id){var a=o.get(n.frameId);if(a){var i=r.screens.find((function(e){return e.id===a}));if(i){var s=t(n.requestHeaders||[]);return s=function(e,r,n){return[].concat(t(e.filter((function(e){return e.name!==n}))),[{name:r,value:n}])}(s,"User-Agent",function(e){var t=e.userAgent,n=r.userAgents.find((function(e){return e.name===t}));return n&&(t=n.value),t}(i)),{requestHeaders:s}}}}};chrome.webRequest.onHeadersReceived.addListener(u,{urls:["<all_urls>"],types:["main_frame","sub_frame"],tabId:e.id},["blocking","responseHeaders","extraHeaders"]),chrome.webNavigation.onCompleted.addListener(d),chrome.webNavigation.onCommitted.addListener(c),chrome.runtime.onMessage.addListener(m),chrome.webRequest.onBeforeRequest.addListener((function r(t){i&&t.tabId===e.id&&(chrome.webRequest.onHeadersReceived.removeListener(u),chrome.webRequest.onBeforeSendHeaders.removeListener(f),chrome.webNavigation.onCompleted.removeListener(d),chrome.webNavigation.onCommitted.removeListener(c),chrome.webRequest.onBeforeRequest.removeListener(r),chrome.runtime.onMessage.removeListener(m))}),{urls:["<all_urls>"],types:["main_frame"],tabId:e.id}),chrome.webRequest.onBeforeSendHeaders.addListener(f,{urls:["<all_urls>"],types:["sub_frame"],tabId:e.id},["blocking","requestHeaders"])}};chrome.browserAction.onClicked.addListener((function(e){i(e)}))}();