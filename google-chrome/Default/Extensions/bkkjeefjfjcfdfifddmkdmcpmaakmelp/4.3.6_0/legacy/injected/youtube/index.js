import { e as e$2 } from '../../../chunks/background.injected-0c5a5e2d.js';
import { l, u, s, t as t$1, n, o, e as e$4, f, i, v, a as a$1, d, c } from '../../../chunks/get_stream_details-d97c917a.js';
import { t, F as Fe, e as e$3 } from '../../../chunks/router.interface-f478261b.js';
import { r } from '../../../chunks/parse_token.util-f24eec6b.js';
import { e } from '../../../chunks/index-5e67059d.js';
import { r as r$1 } from '../../../chunks/request-ce61d6cc.js';
import { e as e$1 } from '../../../chunks/style-inject.es-e19c9629.js';
import { a } from '../../../chunks/consumer-8ba9c119.js';
import '../../../chunks/transframe-provider-e657167f.js';
import '../../../chunks/create-5399fd46.js';

async function S(e){const t=await async function(e,t){const n=t.cookies.SAPISID||t.cookies["__Secure-3PAPISID"];if(!n)return {success:!1,code:400,message:"Missing cookie"};const o=new URL(t.href).origin,i=Math.floor(Date.now()/1e3),r=await async function(e){const t=await crypto.subtle.digest("SHA-1",(new TextEncoder).encode(e));return Array.from(new Uint8Array(t)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(`${i} ${n} ${o}`),s={"x-origin":o,authorization:`SAPISIDHASH ${i}_${r}`,"x-goog-authuser":t.authUser,cookie:Object.entries(t.cookies).map((([e,t])=>`${e}=${t}`)).join(";")};t.pageId&&(s["x-goog-pageid"]=t.pageId);const a=await fetch(`https://www.youtube.com${e}?key=${t.key}`,{method:"POST",headers:s,body:JSON.stringify({context:t.context})});return {success:!0,data:await a.json()}}("/youtubei/v1/account/account_menu",e);if(!t.success)return t;const n=t.data;try{const e=n.actions[0].openPopupAction.popup.multiPageMenuRenderer,t=e.header.activeAccountHeaderRenderer,o=e.sections[0].multiPageMenuSectionRenderer.items[0].compactLinkRenderer.navigationEndpoint.browseEndpoint.browseId.trim().replace(/\n/g,""),i=n.responseContext.mainAppWebResponseContext.datasyncId.split("||")[0];return /^UC.{22}$/.test(o)?{success:!0,data:{id:o,googleUserId:i,profile:t.accountPhoto.thumbnails[0].url,username:t.accountName.simpleText}}:{success:!1,code:400,message:"Failed to authenticate"}}catch(e){return {success:!1,code:400,message:"Failed to authenticate"}}}const E=e=>void 0!==(null==e?void 0:e.months),w=e=>void 0!==(null==e?void 0:e.slug);function A(e){if(!e)return 0;e=e.toLowerCase();const t=/\((.+)\)/.exec(e);if(!t)return 1;const n=t[1].split(/\s/),o=parseInt(n[0]);return isNaN(o)?0:n[1].startsWith("year")?12*parseInt(n[0]):parseInt(n[0])}function x(e,t){const n=t;for(let t=0;t<n.length;t++)if(n[t][0]>e)return n[t-1][1];return n[n.length-1][1]}function T(e){return {liveChatAuthorBadgeRenderer:{accessibility:{accessibilityData:{label:e.slug}},tooltip:e.slug,customThumbnail:{thumbnails:[{url:e.url,width:18,height:18}],accessibility:{accessibilityData:{label:e.slug}}}}}}function j(e,n$1,o,i,r){const s=n$1(e.authorExternalChannelId),a=function(e,t){var n;const o=[];if(e&&t){const i=new Set(null!==(n=null==e?void 0:e.e)&&void 0!==n?n:[]);if(i)for(const e of i){const n=t.get(e);n&&o.push(n);}}return o}(s,o);!function(e,n$1){const o=n(e);var i;(null==n$1?void 0:n$1.a)&&(o.authorName={simpleText:(i=n$1.a,decodeURIComponent(i))});}(e,s),function(e,n$1){var o,i;const r=n(e);r.authorBadges||(r.authorBadges=[]);for(const e of r.authorBadges){const r=n(n(e).liveChatAuthorBadgeRenderer);(null===(o=r.icon)||void 0===o?void 0:o.iconType)?r.mtvType=null===(i=n(r.icon))||void 0===i?void 0:i.iconType.toLowerCase():r.customThumbnail&&(r.mtvType="member"),"moderator"===r.mtvType&&(delete r.icon,r.mtvType="moderator",r.customThumbnail={thumbnails:[{url:n$1,width:18,height:18}]});}}(e,r),function(e,n$1,o){if(!(null==o?void 0:o.b)||o.b<=0)return;const i=n(e);for(const e of i.authorBadges){n(e);const i=n(e.liveChatAuthorBadgeRenderer);if("member"!==i.mtvType)continue;const r=A(i.tooltip);if(0===r)continue;const s=r+o.b,a=`Member (${s} months)`,c=x(s,n$1);i.customThumbnail=c,delete i.icon,i.tooltip=a,n(n(i.accessibility).accessibilityData).label=a;}}(e,i,s),function(e,n$1){const o=n(e);if(o.authorBadges||(o.authorBadges=[]),n$1)for(const e of n$1.slice(0,2))o.authorBadges.push(e);}(e,a);}const k="locked-truffle-emote-category",M="battle-pass-emotes",B=/[\s.,?!]/;function U(e){const t=[];let n=0;for(let o=0;o<e.length-1;o++)B.test(e[o])!==B.test(e[o+1])&&(t.push(e.substring(n,o+1)),n=o+1);return t.push(e.substring(n)),t}function O(e){let t;if(e.provider===e$3.Twitch)t=`https://static-cdn.jtvnw.net/emoticons/v2/${e.id}/static/dark/1.0`;else if(e.provider===e$3.FFZ)t=`https://cdn.frankerfacez.com/emote/${e.id}/1`;else if(e.provider===e$3.BTTV)t=`https://cdn.betterttv.net/emote/${e.id}/1x`;else if(e.provider===e$3.SevenTV)t=`https://cdn.7tv.app/emote/${e.id}/1x`;else if(e.provider===e$3.Spore&&(null==e?void 0:e.ext))t=`https://cdn.bio/ugc/collectible/${e.id}.tiny.${e.ext}`;else if(e.provider===e$3.Custom)t=`https://v2.truffle.vip/emotes/${e.id}`;else {if(e.provider!==e$3.Emotesly)return;t=`https://cdn.jsdelivr.net/gh/bhavita/YTEmotesly/assets/${e.cat}/${e.id}.${e.ext}`;}return {emojiId:"mogultv-"+e.name+"-"+e.id,image:{thumbnails:[{url:t}],accessibility:{accessibilityData:{label:e.name}}},isCustomEmoji:!0,isSporeEmote:e.provider===e$3.Spore,channelId:e.channelId,searchTerms:[e.name],shortcuts:[":"+e.name+":",e.name]}}function N(e,t){return {emojiPickerCategoryRenderer:{categoryId:M,title:{simpleText:t?`${t} emotes`:"Unlocked Truffle Emotes"},emojiIds:e}}}function R(e){return [...e.values()].map((e=>{var n$1;return null===(n$1=n(e))||void 0===n$1?void 0:n$1.emojiId}))}function L(e){return n(n(e).data).categories}function P(e,t){return {emojiPickerUpsellCategoryRenderer:{categoryId:k,title:{simpleText:`Locked ${null!=t?t:"Truffle"} Emotes`},upsell:{runs:[{text:"Unlock emotes through the Truffle Extension"}]},emojiIds:e,emojiToolTip:"Truffle Emote"}}}function D(e){if(e)return function(e,t){return e.filter((e=>{var n;return (null===(n=e.emojiPickerCategoryRenderer)||void 0===n?void 0:n.categoryId)===t})).length}(e,M)}function q(e){if(e)return function(e,n$1){return e.filter((e=>{var o;return (null===(o=n(n(e).emojiPickerUpsellCategoryRenderer))||void 0===o?void 0:o.categoryId)===n$1})).length}(e,k)}function z(e,n$1){var o,i;const r=R(n$1),s=null===(i=n(null===(o=n(e))||void 0===o?void 0:o.data))||void 0===i?void 0:i.categories;if(!s||!(null==r?void 0:r.length))return;const a=s.map((e=>{var n$1;const o=n(null===(n$1=n(e))||void 0===n$1?void 0:n$1.emojiPickerUpsellCategoryRenderer);return (null==o?void 0:o.categoryId)===M&&(o.emojiIds=r),e}));(null==r?void 0:r.length)&&V(e,a);}function F(e,n$1,o){const i=n(_()),r=n(null==i?void 0:i.emojiManager),s=n(null==r?void 0:r.upsellEmotesLoaded);if(r){if(n$1&&!s){r.upsellEmotesLoaded=!0,function(e,t){e.load([...t.values()]);}(r,n$1);const e=J();if(!e)return;q(L(e))||function(e,n$1,o){var i,r;const s=R(n$1);if(!(null==s?void 0:s.length))return;const a=null===(r=n(null===(i=n(e))||void 0===i?void 0:i.data))||void 0===r?void 0:r.categories;Q(a,P(s,o)),V(e,a);}(e,n$1,o);}!function(e,n$1){const o=R(n$1),i=n(e);i.load([...n$1.values()],Object.assign(Object.assign({},e),{emojis:i.emojis.filter((e=>{const n$1=n(e);return !(n$1.isLocked&&!o.includes(n$1.emojiId))}))}));}(r,e);}}function $(e,n$1,o){if(!(null==e?void 0:e.size))return;const i=J();if(!i)return;D(L(i))?(!function(e,n$1){var o,i;const r=R(n$1),s=null===(i=n(null===(o=n(e))||void 0===o?void 0:o.data))||void 0===i?void 0:i.categories;if(!s)return;let a=!1;const c=s.map((e=>{const n$1=n(n(e).emojiPickerCategoryRenderer);if((null==n$1?void 0:n$1.categoryId)===M){const e=n$1.emojiIds.filter((e=>void 0!==e)),t=r.filter((t=>!e.includes(t)));(null==t?void 0:t.length)&&(a=!0),n$1.emojiIds=n$1.emojiIds.concat(t);}return e}));a&&V(e,c);}(i,e),z(i,n$1)):(!function(e,t,n){var o;const i=R(t);if(!(null==i?void 0:i.length))return;const r=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.categories;Q(r,N(i,n)),V(e,r);}(i,e,o),z(i,n$1));}function K(e,n$1){const o=n(_());if(null==o?void 0:o.emojiManager){if(o.emojiManager[n$1])return;o.emojiManager[n$1]=!0,function(e,n$1){n(e).emojiManager.load(Array.from(n$1.values()).filter((e=>!(null==e?void 0:e.isSporeEmote))));}(o,e);}else console.warn("Cannot YT chat list renderer");}function _(){return document.querySelector("yt-live-chat-item-list-renderer")}function J(){return document.querySelector("yt-emoji-picker-renderer")}function V(e,n$1){n(e).updateCategoriesAndPlaceholder({categories:[...n$1]},{});}function Q(e,t){null==e||e.unshift(t);}const H=["#ff0000","#009000","#b22222","#ff7f50","#9acd32","#ff4500","#2e8b57","#daa520","#d2691e","#5f9ea0","#1e90ff","#ff69b4","#00ff7f","#a244f9"];class W{constructor(e){this.gatewayService=e;}addAliasesToMessage(e){j(e,(e=>this.gatewayService.isCurrentUser(e)?this.gatewayService.getSporeUserInfo():this.gatewayService.getUserInfo(e)),this.gatewayService.sporeBadgeCache,this.gatewayService.monthBadgeList,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAABg2lDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV/TiiIVBzuIOGRonSyIijpqFYpQIdQKrTqYXPoFTRqSFBdHwbXg4Mdi1cHFWVcHV0EQ/ABxc3NSdJES/5cUWsR4cNyPd/ced+8AoVFhmhUaAzTdNtPJhJjNrYrdrwgjBGAaMZlZxpwkpeA7vu4R4OtdnGf5n/tz9Kl5iwEBkXiWGaZNvEE8tWkbnPeJI6wkq8TnxKMmXZD4keuKx2+ciy4LPDNiZtLzxBFisdjBSgezkqkRTxJHVU2nfCHrscp5i7NWqbHWPfkLw3l9ZZnrNIeRxCKWIEGEghrKqMBGnFadFAtp2k/4+Idcv0QuhVxlMHIsoAoNsusH/4Pf3VqFiXEvKZwAul4c5yMGdO8CzbrjfB87TvMECD4DV3rbX20AM5+k19ta9Ajo3wYurtuasgdc7gCDT4Zsyq4UpCkUCsD7GX1TDhi4BXrXvN5a+zh9ADLUVeoGODgERoqUve7z7p7O3v490+rvB3pIcqqJKL5aAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5QwEARQDdqq2HwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAGkSURBVDjLpdSxS5tBGMfx7+V9JamLGbSQNNAQdBBJhZKWLPkHxKmQEgd9xUFwCRQKHe1cKHSztCCmLyQlkriULu2kSyBQkCCCg0bQCJrhTSUxoW+8DuLRNPqq8aa7hx8f7nk4TpDXDCQfAC+9rTKCt4KctgcEnZKJ/pcYoRmG+oewz21Wdlb4+PvzvxFLvwlJD5vEx+Lomg5A6ahE/nTt/5hXd0Le+98x9WRKnUtHJSYKkxzLalfW5djSaKILOZCHqvZQDLIwMO8MPdOf4h/wq3Or3epAAuIRP6M/MEYMZyjY1zm6SCBC8XlBId+j3wj7wuiui+lcO6PVszxNu4lH93RiFHBrbsK+MAAnjRNnKBVaxq25u+qRQETt7bZNavfL9a2lQstMj08jhHB8idmtLF8b2atvdBUipaTVbqk2K7UKme0MrytvVEa/DWJumhi7c8QfvKD8p0zR/tV1O0FOk7dBblougE+Pl+6FKGijukGtWesZUZBZT5NcT2KdWT0hl8O2AK9ZT8M6xAZjzO8v3PFLkmVBTpsFuQgi2Nu/Ji3QXv0FPBynaffELJkAAAAASUVORK5CYII=");}}class Z{constructor(e){this.gatewayService=e;}addEmotesToMessage(e){return function(e,n$1){const o=n(e),i=n(o.message),r=o.authorExternalChannelId,s=[];for(const e of i.runs){const o=n(e);if("string"==typeof o.text){const{text:t}=o;let i=0,a=0;const c=U(t);let l=!1;for(const e of c){const o=n$1("ðŸŒ"===e?"Kappa":e,r);o&&(l=!0,i>0&&s.push({text:t.substring(a,i)}),s.push({emoji:o}),a=i+e.length),i+=e.length;}l?s.push({text:t.substring(a,i)}):s.push(e);}else if("ðŸŒ"===n(o.emoji).emojiId){const e=n$1("Kappa",r);e&&s.push({emoji:e});}else s.push(e);}return i.runs=s,o.message}(e,((e,t)=>this.gatewayService.getEmote(e,t)))}}class G extends e.exports.EventEmitter{constructor(e){super(),this.backgroundService=e,this.monthBadgeList=[],this.sporeBadgeCache=new Map,this.emoteCache=new Map,this.upsellSporeEmoteCache=new Map,this.encodedEmoteMap=new Map,this.emoteIndicesMap=new Map,this.sporeUserEmoteCache=new Map,e.getLiveStorageValue("auth.token",r).then((e=>{this.myUserInfo=e;})),l(!1)&&(this.fetchBadges(),this.fetchUserInfo()),setInterval((()=>{l(!1)&&this.fetchBadges();}),t.FIVE_MINUTE_MS),setInterval((()=>{l(!1)&&this.fetchUserInfo();}),t.ONE_MINUTE_MS),setInterval((()=>{l(!1)&&this.fetchCurrentUserSporeInfo();}),t.ONE_SECOND_MS),setInterval((()=>{this.channelUpdatePoll();}),5*t.ONE_SECOND_MS);}async fetchBadges(){const e=await this.backgroundService.fetch("/gateway/badges");if(!Fe(e))return;const t=e.body.filter(E).sort(((e,t)=>e.months-t.months)),n=e.body.filter(w);this.monthBadgeList=t.map((e=>[e.months,{thumbnails:[{url:e.url,width:16,height:16}]}])),this.sporeBadgeCache.clear();for(const e of n){const t=T(e);t&&this.sporeBadgeCache.set(e.slug,t);}this.emit("monthBadges",this.monthBadgeList),this.emit("sporeBadges",this.sporeBadgeCache);}async fetchMaxSuperChatCents(){const e=await this.backgroundService.fetch("/spore/fetch-max-super-chat-cents",this.sporeOrgId);Fe(e)&&(this.maxSuperChatCents=null==e?void 0:e.body.value);}channelUpdatePoll(){const e=u();if(e){const t=e.channelId;t&&t!==this.channelId&&this.setChannelId(t);}}async fetchEmotes(){let e,t;if(e=this.channelId?await this.backgroundService.fetch("/gateway/emotes",this.channelId):await this.backgroundService.fetch("/gateway/emotes"),Fe(e)){try{t=JSON.parse(e.body);}catch(e){t=[];}if(this.emoteCache.clear(),this.normalizeEmotes(t),this.channelId){const e=await async function(e){return await r$1("https://mothertree.truffle.vip/graphql",X,{input:{channelSourceType:"youtube",channelSourceId:e}})}
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */(this.channelId);e.emotes.emotes.forEach((t=>{const n=function(e,t){return {emojiId:"truffle-"+e.name+"-"+e.id,image:{thumbnails:[{url:Y(e,t)}],accessibility:{accessibilityData:{label:e.name}}},isCustomEmoji:!0,searchTerms:[e.name],shortcuts:[":"+e.name+":",e.name]}}(t,e.emotes.providers);this.emoteCache.set(t.name,n);}));}this.emit("emotes",this.emoteCache);}}normalizeEmotes(e){this.normalizeUnlockedEmotes(e),this.normalizeLockedEmotes();}normalizeUnlockedEmotes(e){for(const t of e){const e=O(t);e&&(this.emoteCache.set(t.name,e),void 0!==t.bitIndex&&this.encodedEmoteMap.set(t.name,t.bitIndex));}}normalizeLockedEmotes(){for(const e of this.emoteCache.values())if((null==e?void 0:e.isSporeEmote)&&(null==e?void 0:e.channelId)===this.channelId){const t=Object.assign(Object.assign({},e),{isLocked:!0});this.upsellSporeEmoteCache.set(e.searchTerms[0],t);}}async fetchUserInfo(){let e;e=this.channelId?await this.backgroundService.fetch("/gateway/users",this.channelId):await this.backgroundService.fetch("/gateway/users"),Fe(e)&&(this.infoCache=new Map(JSON.parse(e.body)),this.emit("users",this.infoCache));}async fetchSporeChannel(){var e,t,n;const o=await this.backgroundService.fetch("/spore/fetch-youtube-channel",this.channelId);Fe(o)&&(this.sporeOrgId=null===(e=o.body.value)||void 0===e?void 0:e.sporeOrgId,this.truffleEmoteCategoryName=null===(n=null===(t=o.body.value)||void 0===t?void 0:t.seasonPass)||void 0===n?void 0:n.name);}async setChannelId(e){this.channelId=e,this.fetchUserInfo(),this.fetchBadges(),await this.fetchSporeChannel(),await this.fetchEmotes(),await this.fetchCurrentUserSporeInfo(!0),await this.fetchMaxSuperChatCents();}async fetchCurrentUserSporeInfo(e=!1){var t,n,o,i;const r=null===(n=null===(t=this.myUserInfo)||void 0===t?void 0:t.value)||void 0===n?void 0:n.sub;if(r&&this.sporeOrgId)try{const t=await this.backgroundService.fetch("/spore/fetch-spore-user",{connectionSourceId:r,sporeOrgId:this.sporeOrgId,invalidateCache:!!e});if(!Fe(t))return;if(this.mySporeUserInfo=t.body.value,!t.body.isCached&&(null===(o=null==t?void 0:t.body.value)||void 0===o?void 0:o.emotes)&&(null===(i=null==t?void 0:t.body.value)||void 0===i?void 0:i.serializedEmotes)){for(const e of t.body.value.serializedEmotes){const t=O(e);t&&!this.sporeUserEmoteCache.get(e.name)&&this.sporeUserEmoteCache.set(e.name,t),this.upsellSporeEmoteCache.get(e.name)&&this.upsellSporeEmoteCache.delete(e.name);}this.emit("spore-user-emotes",this.sporeUserEmoteCache,this.upsellSporeEmoteCache,this.truffleEmoteCategoryName);}}catch(e){console.warn("error fetching spore user",e);}}getEmoteCategoryInfo(){return {emotes:this.sporeUserEmoteCache,upsellEmotes:this.upsellSporeEmoteCache,truffleEmoteCategoryName:this.truffleEmoteCategoryName}}getSerializedMetadata(e){const t={a:null==e?void 0:e.name,b:null==e?void 0:e.subbedMonths,c:e.nameColor};return Object.values(t).filter((e=>void 0!==e)).length>0?t:void 0}getSerializedSporeMetadata(e){const t={a:null==e?void 0:e.name,b:null==e?void 0:e.subbedMonths,c:null==e?void 0:e.nameColor,e:e.badges};return Object.values(t).filter((e=>void 0!==e)).length>0?t:void 0}getUserInfo(e){var t,n;if((null===(t=this.mySporeUserInfo)||void 0===t?void 0:t.id)===e&&this.mySporeUserInfo){const e=this.getSerializedMetadata(this.mySporeUserInfo);if(e)return e}return null===(n=this.infoCache)||void 0===n?void 0:n.get(e)}getSporeUserInfo(){var e;if((null===(e=this.myUserInfo)||void 0===e?void 0:e.value)&&this.mySporeUserInfo){const e=this.getSerializedSporeMetadata(this.mySporeUserInfo);if(e)return e}}getSporeBadges(e){var t,n,o;const i=[];if(this.isCurrentUser(e)){const e=new Set(null!==(n=null===(t=this.mySporeUserInfo)||void 0===t?void 0:t.badges)&&void 0!==n?n:[]);for(const t of e){const e=this.sporeBadgeCache.get(t);e&&i.push(e);}}else {const t=this.infoCache.get(e);if(t){const e=new Set(null!==(o=null==t?void 0:t.e)&&void 0!==o?o:[]);for(const t of e){const e=this.sporeBadgeCache.get(t);e&&i.push(e);}}}return i}getEmote(e,t$1){var n,o,i,r,s,a;const c=null===(n=this.emoteCache)||void 0===n?void 0:n.get(e);if(null==c?void 0:c.isSporeEmote)if(this.isCurrentUser(t$1)){const t=null!==(i=null===(o=this.mySporeUserInfo)||void 0===o?void 0:o.emotes)&&void 0!==i?i:[];if((null===(r=this.mySporeUserInfo)||void 0===r?void 0:r.emotes)&&!t.includes(e))return}else {const n=null===(s=this.infoCache.get(t$1))||void 0===s?void 0:s.d;if(n){const t$1=null===(a=this.encodedEmoteMap)||void 0===a?void 0:a.get(e),o=function(e,t$1,n=!0){const o=()=>{const t$1=[];for(let n=0;n<e.length;n++)t$1[e.length-1-n]=e.charCodeAt(n)-t.ASCII_OFFSET;const n=[];for(let e=0;e<t$1.length;e++)if(0!==t$1[e])for(let o=0;o<6;o++)0!=(t$1[e]&1<<o)&&n.push(6*e+o);return n};if(n){const n=t$1.get(e);if(n)return n;const i=o();return t$1.set(e,i),i}return o()}(n,this.emoteIndicesMap,!0);if(void 0!==t$1&&!o.includes(t$1))return}}return c}isCurrentUser(e){var t,n;return e===(null===(n=null===(t=this.myUserInfo)||void 0===t?void 0:t.value)||void 0===n?void 0:n.sub)}}const X="\n  query ExtensionEmotesQuery($input: EmotesInput!) @cache {\n    emotes(input: $input) {\n        providers\n        emotes {\n            id\n            # sourceId\n            sourceType\n            name\n            urlParams\n        }\n    }\n  }\n";function Y(e,t){let n=t[e.sourceType].urlTemplate;for(const t of e.urlParams)n=n.replace("{}",t);return n}var ee,te=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var n={},o=t||{},i=e.split(";"),r=o.decode||ne,s=0;s<i.length;s++){var a=i[s],c=a.indexOf("=");if(!(c<0)){var l=a.substring(0,c).trim();if(null==n[l]){var u=a.substring(c+1,a.length).trim();'"'===u[0]&&(u=u.slice(1,-1)),n[l]=oe(u,r);}}}return n},ne=decodeURIComponent;function oe(e,t){try{return t(e)}catch(t){return e}}async function ie(e,o){await customElements.whenDefined(e);const i=customElements.get(e),r=i&&n(i.prototype);if(!i)return void console.warn(`Polymer: ${e} not found`);const s=r[o.functionName];r[o.functionName]=function(...e){if(o.enabledLivestreamOnly&&!l())return s.apply(this,e);if(o.type===ee.OverrideFunction)try{return o.function.apply(this,e)}catch(e){console.error(JSON.stringify(o)),console.error(e);}if(o.type===ee.ModifyArgs)try{const t=o.function.apply(this,e);return s.apply(this,"string"==typeof t?[t]:t)}catch(e){console.error(JSON.stringify(o)),console.error(e);}if(o.type===ee.RunBefore)try{o.function.apply(this,e);}catch(e){console.error(e);}let t=s.apply(this,e);if(o.type===ee.RunAfter)try{t=o.function.apply(this,[t]);}catch(e){console.error(e);}return t};}!function(e){e[e.ModifyArgs=0]="ModifyArgs",e[e.OverrideFunction=1]="OverrideFunction",e[e.RunBefore=2]="RunBefore",e[e.RunAfter=3]="RunAfter";}(ee||(ee={}));const re=(e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:ee.OverrideFunction}),se=(e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:ee.ModifyArgs}),ae=(e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:ee.RunBefore}),ce=(e,t,{EnabledLivestreamOnly:n})=>({functionName:e,function:t,enabledLivestreamOnly:n||!1,type:ee.RunAfter}),le=!0;function ue(e){const n$1=n(e);return n$1?n$1.mtvType?n$1.mtvType:n$1.icon?n(n$1.icon).iconType.toLowerCase():n$1.customThumbnail?"member":"":""}async function de(e){ie("yt-live-chat-author-badge-renderer",re("computeType",(e=>ue(n(e).liveChatAuthorBadgeRenderer)),{EnabledLivestreamOnly:le})),ie("yt-live-chat-author-chip",re("computeAuthorType",(function(n$1){var o,i,r;const s=n(this),a=n(s.$)["author-name"];if(a){let n$1;const c=n(null===(o=this.parentElement)||void 0===o?void 0:o.parentElement),l=n(null!==(i=null==c?void 0:c.data)&&void 0!==i?i:{}).authorExternalChannelId;if(l){const t=e.getUserInfo(l);(null==t?void 0:t.c)&&(n$1=t.c);}const u=n(null!==(r=s.authorName)&&void 0!==r?r:{});n$1||(n$1=function(e){const t=function(e){let t=0;if(0===e.length)return 0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(e);return H[(t%H.length+H.length)%H.length]}(u.simpleText)),a.style.color=n$1;}return function(e){if(!e)return "";for(const n$1 of e){const e=n(n$1);if(!e.liveChatAuthorBadgeRenderer)continue;const o=ue(n(e.liveChatAuthorBadgeRenderer));if("verified"!==o)return o}return ""}(n$1)}),{EnabledLivestreamOnly:le}));}const he="\n  query ExtensionEmotesQuery($input: EmotesInput!) @cache {\n    emotes(input: $input) {\n        providers\n        emotes {\n            id\n            # sourceId\n            sourceType\n            name\n            urlParams\n        }\n    }\n  }\n";async function me(){var e,n$1;const i=u();if(!i)return;const r=await r$1("https://mothertree.truffle.vip/graphql",he,{input:{channelSourceType:"youtube",channelSourceId:i.channelId}}),s=r.emotes.emotes.map((e=>function(e,t,n){return {emojiId:"truffle-"+e.name+"-"+e.id,image:{thumbnails:[{url:fe(e,t)}],accessibility:{accessibilityData:{label:e.name}}},isCustomEmoji:!0,channelId:n,searchTerms:[e.name],shortcuts:[":"+e.name+":",e.name]}}(e,r.emotes.providers,i.channelId||""))),a=n(J()),c=n(_()),l=null===(e=null==a?void 0:a.data)||void 0===e?void 0:e.categories;null===(n$1=n(c))||void 0===n$1||n$1.emojiManager.load(s),Q(l,{emojiPickerCategoryRenderer:{categoryId:"global-truffle-emotes",title:{simpleText:"Truffle Emotes"},emojiIds:s.map((e=>e.emojiId))}}),V(a,l);}function fe(e,t){let n=t[e.sourceType].urlTemplate;for(const t of e.urlParams)n=n.replace("{}",t);return n}e$1("/* Make the masthead transparent unless we are hovering it */\nbody[data-mogul-theater-mode] #masthead-container {\n  opacity: 0.1;\n  transition: opacity 0.2s ease;\n}\n\nbody[data-mogul-theater-mode] #masthead-container:hover {\n  opacity: 1;\n}\n/* https://discord.com/channels/839188384752599071/1123706607168143400 */\n@media screen and (min-width: 1014px) {\n  /* Make chat fill screen vertically */\n  body[data-mogul-theater-mode] #chat.ytd-watch-flexy {\n    height: calc(100vh - 56px) !important;\n    width: var(--ytd-watch-flexy-sidebar-width);\n    position: absolute !important;\n    top: 56px;\n    right: 0;\n  }\n\n  body[data-mogul-theater-mode] #player-full-bleed-container.ytd-watch-flexy {\n    width: calc(100vw - var(--ytd-watch-flexy-sidebar-width) - var(--ytd-watch-flexy-scrollbar-width)) !important;\n    max-width: calc(100vw - var(--ytd-watch-flexy-sidebar-width) - var(--ytd-watch-flexy-scrollbar-width)) !important;\n    height: calc(100vh - 56px) !important;\n    max-height: calc(100vh - 56px) !important;\n  }\n\n  body[data-mogul-theater-mode] #secondary.ytd-watch-flexy {\n    position: unset;\n  }\n}\n");let ve=!1;const pe=new e$2;function ge(){const e=document.querySelector("ytd-live-chat-frame iframe");if(e)if(e.src.includes("query-4-3.6")){const t=e.src.substring(e.src.indexOf("#")+1),n=o(t),o$1=e$4();if(o$1&&(null==n?void 0:n.videoId)!==(null==o$1?void 0:o$1.videoId)){const t=document.querySelector("ytd-live-chat-frame"),n=f(t,o$1);e.src=n;}}else {const t=u();e.src+=`#query-4-3.6=${encodeURIComponent(JSON.stringify(t))}`;}else if(i()){const e=v();if(e){let t=a$1(e);const n=d();(null==n?void 0:n.channelId)&&t&&((null==t?void 0:t.includes("query-4-3.6"))||(t+=`#query-4-3.6=${encodeURIComponent(JSON.stringify(n))}`,c(e,t)));}}}if(s()){const e=new G(pe),r=new Z(e),s=new W(e);ye=e,be=s,Ie=r,me(),function(e,o,r){ie("yt-live-chat-item-list-renderer",ae("handleAddChatItemAction",(function(n$1){const i=n(n(n$1).item);i.liveChatTextMessageRenderer&&(o.addAliasesToMessage(i.liveChatTextMessageRenderer),e.addEmotesToMessage(i.liveChatTextMessageRenderer));}),{EnabledLivestreamOnly:le})),ie("yt-live-chat-text-input-field-renderer",ce("calculateLiveChatRichMessageInput",(function(e){var n$1,o;if(!(null==e?void 0:e.textSegments))return e;for(const i of e.textSegments){const e=n(i);if((null===(n$1=e.emojiId)||void 0===n$1?void 0:n$1.startsWith("mogultv"))||(null===(o=e.emojiId)||void 0===o?void 0:o.startsWith("truffle"))){const[,t]=e.emojiId.split("-");delete e.emojiId,e.text=t;}}return e}),{EnabledLivestreamOnly:le})),ie("yt-emoji-picker-renderer",se("updateCategoriesAndPlaceholder",(function(e,n$1){const o=r.getEmoteCategoryInfo(),i=n(e).categories;if(!q(i)){const e=R(o.upsellEmotes);(null==e?void 0:e.length)&&Q(i,P(e,o.truffleEmoteCategoryName));}if(!D(i)){const e=R(o.emotes);(null==e?void 0:e.length)&&Q(i,N(e,o.truffleEmoteCategoryName));}return [e,n$1]}),{EnabledLivestreamOnly:le})),r.on("emotes",(e=>{l()&&(t$1()||K(e,"_mogulTvLoaded"));})),r.on("spore-user-emotes",((e,t,o)=>{l()&&(t$1()||(F(e,t,o),$(e,t,o)));}));}(Ie,be,ye),function(e){const n$1=document.querySelector("yt-live-chat-renderer"),o=new MutationObserver((n$1=>{if(null==e?void 0:e.maxSuperChatCents){const o=document.querySelector("yt-live-chat-message-buy-flow-renderer"),i=n(o),r=n(null==i?void 0:i.data),s=()=>{const n$1=null==r?void 0:r.messageTiers,o=null==r?void 0:r.currency;if(i&&(null==n$1?void 0:n$1.length)&&(null==e?void 0:e.maxSuperChatCents)&&"USD"===o){const o=e.maxSuperChatCents*t.MICROS_PER_CENT,r=n$1.filter((n$1=>{const o=n(n$1);e.maxSuperChatCents&&parseInt(o.minPriceMicros);}));r[r.length-1]&&(n(r[r.length-1]).maxPriceMicros=`${o}`),(null==r?void 0:r.length)&&n$1.length!==r.length&&(null==i||i.setupBuyFlowState(r,null==i?void 0:i.buyButton));}};if(o&&document.contains(o))for(const e of n$1)if(Array.from(e.addedNodes).includes(o)){s();break}}}));n$1&&o.observe(n$1,{attributes:!1,childList:!0,characterData:!1,subtree:!0});}(ye),ie("yt-live-chat-renderer",se("openPopoutWindow",(function(e){if(!(null==e?void 0:e.includes("query-4-3.6"))){const t=u();return e+`#query-4-3.6=${encodeURIComponent(JSON.stringify(t))}`}return e}),{EnabledLivestreamOnly:le})),de(ye);const a=setInterval((()=>{const t=u(),n=null==t?void 0:t.channelId;n&&(clearInterval(a),e.setChannelId(n));}),t.ONE_SECOND_MS);ve||(ve=!0,setInterval((()=>ge()),t.ONE_SECOND_MS));}else !async function(){let e=await a.storageBucketGet("settings","theaterMode");try{a.storageBucketSubscribe("settings",(t=>{"theaterMode"in t&&(e=t.theaterMode);}));}catch(e){console.log("Error listening to theater mode settings");}setInterval((()=>{const t=document.querySelector("ytd-watch-flexy"),n=document.querySelector("ytd-live-chat-frame"),o=!(null==t?void 0:t.hasAttribute("fullscreen")),i=!(null==n?void 0:n.hasAttribute("collapsed")),r=null==t?void 0:t.hasAttribute("theater"),s=n&&e&&o&&i&&r,a=document.body.hasAttribute("data-mogul-theater-mode");s&&!a?(document.body.setAttribute("data-mogul-theater-mode",""),window.dispatchEvent(new Event("resize"))):!s&&a&&(document.body.removeAttribute("data-mogul-theater-mode"),window.dispatchEvent(new Event("resize")));}),500);}(),async function(e){if(!window.ytcfg)return;const t={key:window.ytcfg.get("INNERTUBE_API_KEY"),authUser:window.ytcfg.get("SESSION_INDEX"),pageId:window.ytcfg.get("DELEGATED_SESSION_ID"),href:window.location.href,context:window.ytcfg.get("INNERTUBE_CONTEXT")};(function(e,t){var n,o;if(!e.success||!t.meta.isSuccess)return !0;return !!(e.data.id!==(null===(n=t.body)||void 0===n?void 0:n.sub))||!(null===(o=t.body)||void 0===o?void 0:o.googleId)})(await S(Object.assign(Object.assign({},t),{cookies:te(document.cookie)})),await e.fetch("/auth/@me"))&&await e.fetch("/auth/login",t);}(pe),ve=!0,setInterval((()=>ge()),t.ONE_SECOND_MS);var ye,be,Ie;
